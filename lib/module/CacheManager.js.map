{"version":3,"names":["SHA1","FileSystem","defaultConfiguration","retry","fn","retriesLeft","arguments","length","undefined","CacheManager","config","maxRetries","interval","retryDelay","request","status","Error","error","message","Promise","resolve","setTimeout","CacheEntry","pathResolved","noCache","constructor","source","options","maxAge","getPath","exists","path","getCacheEntry","downloadPromise","download","result","fetch","e","__DEV__","console","log","cacheLimit","pruneCache","defaultConfig","newConfig","entries","get","_CacheManager$entries","_options$headers","headers","Authorization","clearCache","baseDir","files","ls","file","unlink","removeCacheEntry","entry","getCacheSize","stat","size","isImageCached","prefetch","forEach","image","prefetchBlob","blob","readFile","statDir","sort","a","b","lastModified","currentCacheSize","reduce","cacheSize","overflowSize","shift","catch","cacheKey","newCacheKey","getCustomCacheKey","filename","substring","lastIndexOf","indexOf","ext","sha","mkdir","ageInHours","Math","floor","Date","now"],"sourceRoot":"../../src","sources":["CacheManager.ts"],"mappings":"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"}